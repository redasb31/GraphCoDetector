


<p>
盤面上にロボットと壁，ゴールが設置されており， ロボットの行動パターンを記述したプログラムが与えられる．
</p>

<p>
与えられるプログラムは以下のEBNF で表される．
</p>

<pre>
プログラム:= {文};
文:= if 文|while 文|動作文;
if 文:= "[", 条件, プログラム, "]";
while 文:= "{", 条件, プログラム, "}";

動作文:= "^"|"v"|"<"|">";
条件:= ["~"], "N"|"E"|"S"|"W"|"C"|"T";
</pre>

<p>
「プログラム」は0個以上の「文」からなり，1つ以上の文が存在する場合は 1 つ目の文から順番に1 つずつ文が実行される．「文」は「動作文」，「if 文」，「while 文」のいずれかである．「動作文」は"<span>^</span>", "<span>v</span>","<span><</span>","<span>></span>" のいずれかであり，それぞれ以下の動作が実行される．
</p>

<ul>
<li> "<span>^</span>": 前進 </li>
<li> "<span>v</span>": 後退 </li>
<li> "<span><</span>": 左に90 度回転 </li>
<li> "<span>></span>": 右に90 度回転 </li>
</ul>

<p>
「if 文」は "<span>[</span>"，「条件」，「プログラム」，"<span>]</span>" を順番に並べたもので，以下の手順で実行される．
</p>

<ol>
<li> 「条件」の内容が真かどうか判定する </li>
<li> 判定が真なら「プログラム」の内容を実行し，このif 文の処理を終了する</li>
<li> 判定が偽ならこのif 文の処理を終了する</li>
</ol>

<p>
「while 文」は "<span>{</span>"，「条件」，「プログラム」，"<span>}</span>" を順番に並べたもので，以下の手順で実行される．
</p>

<ol>
<li> 「条件」の内容が真かどうか判定する </li>
<li> 判定が真なら「プログラム」の内容を実行し，1 に戻る</li>
<li> 判定が偽なら，この while 文の処理を終了する</li>
</ol>

<p>
「条件」は "<span>N</span>", "<span>E</span>", "<span>S</span>", "<span>W</span>", "<span>C</span>", "<span>T</span>" のいずれかであり，先頭には"<span>~</span>" をつけることができる．それぞれの記述は以下の真偽値を表す．
</p>


<ul>
<li> 先頭に "<span>~</span>" が付いている場合は真偽値が逆転 </li>
<li> <span>N</span>: 北を向いているならば真，そうでなければ偽</li>
<li> <span>E</span>: 東を向いているならば真，そうでなければ偽</li>
<li> <span>S</span>: 南を向いているならば真，そうでなければ偽</li>
<li> <span>W</span>: 西を向いているならば真，そうでなければ偽</li>
<li> <span>C</span>: 目の前に壁があるならば真，そうでなければ偽</li>
<li> <span>T</span>: 常に真</li>
</ul>

<p>
ロボットは最初，北を向いているものとする．ロボットは壁を通ることができず，何もないマスのみを移動できる．もし，プログラムが壁の上を通るような動作を実行しようとした場合，ロボットは移動せずその場にとどまる．最後に，ロボットはゴールに到達した時，実行途中のプログラムが残っていたとしてもすべて中断して動作を停止する．
</p>

<p>
このとき，ロボットがゴールにたどり着くまでにどのぐらい時間がかかるのか知りたい．ロボットは条件判定やプログラムの読み込みに関しては非常に高速に実行できるので実際の動作時間を決定するのは「動作文」のみである．そこで，このロボットがゴールに辿り着くまでに「動作文」を何回実行するかを教えてほしい．
</p>

<p>
なお，壁の上を通るような動作を実行しようとして，実際には「動作文」の動作が行われなかった場合にも「動作文」は実行されたものとみなす．
</p>

<h2>Input</h2>
<p>
入力は以下の形式で与えられる．
</p>

<pre>
<var>H</var> <var>W</var>
<var>a<sub>1,1</sub>a<sub>1,2</sub> . . . a<sub>1,W</sub></var>
<var>a<sub>2,1</sub>a<sub>2,2</sub> . . . a<sub>2,W</sub></var>
: : :
<var>a<sub>H,1</sub>a<sub>H,2</sub> . . . a<sub>H,W</sub></var>
<var>s</var>
</pre>

<p>
<var>H</var> は盤面の高さ，<var>W</var> は盤面の幅を表す．
</p>

<p>
次に盤面を真上から見た状態が与えられる．この盤面は上，下，左，右がそれぞれ北，南，西，東に対応する．各マスの状態を表す <var>a<sub>i,j</sub></var> は以下のいずれかの文字である．
</p>

<ul>
<li> "<span>s</span>" : ロボット（ロボットの初期位置．このマスには壁がないことが保証されている）</li>
<li> "<span>g</span>" : ゴール</li>
<li> "<span>#</span>" : 壁（ロボットは壁の上を移動することはできない）</li>
<li> "<span>.</span>" : 何もないマス</li>
</ul>

<p>
<var>s</var> にはロボットに与えられるプログラムが文字列として入力される．
</p>

<h2>Constraints</h2>
<ul>
<li> 1 &le;  <var>H,W</var> &le; 50</li>
<li> 1 &le; <var>s</var> の文字数 &le; 1,000</li>
<li> <var>a<sub>i,j</sub></var> は"<span>.</span>", "<span>#</span>", "<span>s</span>", "<span>g</span>" のいずれか</li>
<li> "<span>s</span>", "<span>g</span>" はそれぞれ 1 回しか登場しない</li>
<li> <var>i = 1</var> または <var>i = H</var> または <var>j = 1</var> または <var>j = W</var> ならば <var>a<sub>i,j</sub></var> = "<span>#</span>"（盤面の外周は壁で囲まれていることが保証されている）</li>
<li> <var>s</var> として与えられるプログラムは構文的に正しい</li>
</ul>



<h2>Output</h2>

<p>
たどり着ける場合は"到達するまでに実行した「動作文」の数" を，たどりつけない場合は "-1" を出力せよ．なお，壁の上を通るような動作を実行しようとして，実際には「動作文」の動作が行われなかった場合にも「動作文」が実行されたものとみなす点に注意せよ（入力例1）．
</p>

<h2>Sample Input 1</h2>
<pre>
5 3
###
#g#
#.#
#s#
###
^&lt;^&lt;vv
</pre>

<h2>Output for the Sample Input 1</h2>
<pre>
5
</pre>

<h2>Sample Input 2</h2>
<pre>
5 7
#######
#.#g..#
#.###.#
#s....#
#######
{T{~C^}&lt;}
</pre>

<h2>Output for the Sample Input 2</h2>
<pre>
17
</pre>

<h2>Sample Input 3</h2>
<pre>
5 7
#######
#.#g..#
#.###.#
#s....#
#######
{T{~C^}>}
</pre>

<h2>Output for the Sample Input 3</h2>
<pre>
-1
</pre>

