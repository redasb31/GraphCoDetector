

<script src="./IMAGE/varmath.js" charset="UTF-8"></script>

<h1>Problem J: J's Final Problem</h1>
<h2>Problem</h2>

<p>
不思議なダンジョンとは構造の変化を伴うダンジョンである。不思議なダンジョンは階層が深いものから浅いものまで様々なものがあり、深い階層には凶悪なモンスターが生息していたり、財宝が眠っていたりする。ジェイは不思議なダンジョンを研究している研究者である。ある日、新しいダンジョンを掘っていたところ、とても大きく深いダンジョンに繋がってしまった。ジェイはこのダンジョンを「ジェイの最終問題」と名付けた。このダンジョンの調査が、優秀な冒険者であるあなたに依頼されることになった。冒険者の目的はできるだけ深い層のフロアに到達することである。このダンジョンの特徴を以下に述べる。
</p>

<ul>
<li>地上からダンジョンの地下1階の部屋への下りの階段は1つしか存在しない。</li>
<li>各部屋は1つの上りの階段と2つの下りの階段が存在する。</li>
<li>2つの下りの階段のうち片方を右の階段、もう片方を左の階段とする。</li>
<li>冒険者が階段を降りた際に、ダンジョンの構造が変化することがある。</li>
<li>階段を降りるとは、地下<var>i</var>階のある部屋から地下<var>i</var>+1階のある部屋へ降りることを示す。</li>
<li>階段を上った場合はダンジョンに対して何も変化を及ぼさない。</li>
<li>地下<var>n</var>階目には階段は存在しない。</li>
</ul>

<p>
最近、ジェイの最終問題に関する石碑が発見された。
どうやら、各階の階段を降りたときの変化がメモとして記されているようだ。

メモの形式は、
</p>

<ul>
<var>num1</var> <var>direction1</var> : <var>num2</var> <var>direction2</var> 
</ul>

<p>
という形である。

地下<var>num1</var>階のすべての部屋について、direction1の階段を降りている途中で、地下num2階のすべての部屋について、 direction2の階段を降りた先の部屋が消滅し、さらにそこから階段を降りることによって到達できる部屋や階段がすべて消滅する。部屋や階段の消滅に冒険者が巻き込まれた場合、冒険は失敗する。地下<var>i</var>階から地下<var>i</var>+1階へ向かう階段の途中で冒険者が失敗した場合は地下<var>i</var>階まで到達したものとして扱う。

石碑において言及されていない階段は、その階段を降りてもダンジョンの構造に変化を及ぼさないことを示す。

<br/>
<br/>
冒険者はこの石碑をヒントにして探索を行うことにした。
</p>

<p>
ダンジョンの深さ<var>n</var>とメモの情報が<var>m</var>個与えられるので、最大地下何階まで到達できるかを答えなさい。
</p>

<h2>Input</h2>
<p>

入力は複数のデータセットからなる。</br>

</p>

<pre>
<var>n</var>　<var>m</var>
<var>memo<sub>1</sub></var>
<var>memo<sub>2</sub></var>
…
<var>memo<sub>m</sub></var>
</pre>

<p>
最初に<var>n</var>,<var>m</var>が与えられる。
それぞれ、ダンジョンの変化前の最下層の階数、石碑のメモの数を表す。
次に<var>m</var>行にわたりメモの情報 <var>num1</var> <var>direction1</var> : <var>num2</var> <var>direction2</var> が与えられる。
</p>


<h2>Constraints</h2>
<p>入力は以下の条件を満たす。</p>
<ul>

<li>入力に含まれる値はすべて整数</li>
<li>1 &le; <var>n</var> &le; 10000</li>
<li>0 &le; <var>m</var> &le; (<var>n</var>-1)&times;4</li>
<li>1 &le; <var>num1</var>,<var>num2</var> &le; <var>n</var>-1</li>
<li>direction1,direction2は"left"と"right"のいずれかである。</li>

</ul>

<h2>Output</h2>
<p>
最大地下何階まで降りることができるか1行に出力して答えよ。
</p>

<h2>Sample Input1</h2>
<pre>
10 2
9 left : 9 left
9 right : 9 right
</pre>

<h2>Sample Output1</h2>
<pre>
9
</pre>


<h2>Sample Input2</h2>
<pre>
4 5
1 left : 2 right
2 left : 3 right
2 left : 3 left
1 right : 3 left
2 right : 3 right
</pre>

<h2>Sample Output2</h2>
<pre>
3
</pre>