

<script src="./IMAGE/varmath.js" charset="UTF-8"></script>

<h1>Problem I: Rolling Block</h1>
<h2>Problem</h2>

<p>
Rolling Blockは直方体の金属体を回転させつつ移動させ、ゴールの穴に落とすゲームである。<br/>
このゲームのクリア条件は金属体をゴールに落とすことである。<br/>
<br/>
<img src="https://judgeapi.u-aizu.ac.jp/resources/images/IMAGE3_ACPC2013Aizu_aizuicpc_image0" width="500" height="500" alt="image0">
</p>

<p>
<b>ブロックについて</b><br/>
下の図の(1)より、ブロックは1&times;1&times;<var>L</var>の直方体である。
ブロックは東西南北のどれかの方向に回転しながら移動することができる。
しかし、ブロックはステージからはみ出るような動きをとることは出来ない。<br/>
下の図の(2)より、ブロックが横に倒れている場合は移動方向に対してこのような回転をしつつ移動する。<br/>
下の図の(3)より、ブロックが直立している場合は移動方向に対してこのような回転をしつつ移動する。<br/>
(2) 、(3) については灰色のブロックが移動前、白色のブロックが移動後のブロックとする。<br/>
黒い矢印はその方向に対してブロックが移動したことを示す。
また、白の矢印は移動する際にブロックがその方向へ回転したことを示す。
ブロックに点線が引かれているが、これは回転を分かりやすくするために引いたものである。
（実際にゲームで扱うブロックにはこのような点線は書かれていない）<br/>
<img src="https://judgeapi.u-aizu.ac.jp/resources/images/IMAGE3_ACPC2013Aizu_aizuicpc_image1" width="500" height="500" alt="image1">

<br/>
以下の図はブロックの回転を補足するための図である。
サイコロのように対面の和が7になるようなブロックがあるとする。
直立している場合と倒れているブロックについて、このブロックを東西南北の4方向へ回転しつつ移動させたときの上面の数字の変化を以下の図に示す。
（実際にゲームで扱うブロックにはこのような数字は書かれていない。）<br/>

<img src="https://judgeapi.u-aizu.ac.jp/resources/images/IMAGE3_ACPC2013Aizu_aizuicpc_image2" width="500" height="500" alt="image2">
</p>

<p>
<b>ステージについて</b><br/>
ステージは<var>H</var>&times;<var>W</var>の二次元グリッドで与えられる(1 &le; <var>H</var>,<var>W</var> &le; 25) 。
二次元グリッドはそれぞれ以下の種類のセルから成る。
</p>
<ul>
  <li>
    <p>"." 床<br/>
      床の上にブロックが乗ることができる。
    </p>
  </li>

  <li>
    <p>"#" 壁<br/>
      壁には進行不可能であり、ブロックの一部が壁の上に乗るような移動はできない。
    </p>
  </li>

  <li>
    <p>"S" ブロックの初期位置<br/>
      ブロックは１文字だけ与えられる。初期状態では直立している状態しか存在しない。
    </p>
  </li>

  <li>
    <p>"G" ゴール地点<br/>
      ゴールはステージ中に１つしか出現しない。<br/>
      また、ブロックが直立している状態でしかゴールすることは不可能である。<br/>
    </p>
  </li>

  <li>
    <p>特殊壁とスイッチ<br/>
      アルファベット小文字 特殊壁<br/>
      アルファベット大文字 特殊壁に対応するスイッチ<br/>
      <br/>
      特殊壁は出現時には進行不可能であり、ブロックの一部が特殊壁の上に乗るような移動はできない。
      ブロックが回転を行い直立したときにブロックの真下にスイッチがあるとき、そのスイッチは押される。<br/>
      スイッチを押したとき、同じアルファベットの特殊壁が出現しているときは消滅し、逆に消滅しているときは出現する。<br/>
      ステージ開始直後ではすべての特殊壁が出現しているとする。<br/>
      ひとつのステージで現れる特殊壁とスイッチは最大５種類とする。<br/>
      スイッチを表すアルファベットは{'A','B','C','D','E'}である。<br/>
      特殊壁を表すアルファベットは{'a','b','c','d','e'}である。<br/>
      スイッチと特殊壁の数は<var>H</var>&times;<var>W</var>個以下である。<br/>
      特殊壁と同じアルファベットのスイッチがステージの中に必ず出現するとは限らない。<br/>
      また、スイッチと同じアルファベットの特殊壁がステージの中に必ず出現するとは限らない。<br/>
    </p>
  </li>  

  <li>
    <p>"^" トラップ<br/>
      トラップのマスの上には直方体が直立した状態で乗ってはいけない。
    </p>
  </li>
</ul>

<p>
ステージの情報と金属体の初期位置が与えられるので、このパズルを解く最短手数を求めよ。
解が存在しない場合は-1を出力しなさい。
</p>

<h2>Input</h2>

<pre>
<var>H</var> <var>W</var>  <var>L</var>
<var>Cell<sub>1-1</sub></var> ... <var>Cell<sub>1-W</sub></var>
.
.
.
<var>Cell<sub>H-1</sub></var> ... <var>Cell<sub>H-W</sub></var>
</pre>

<p>
最初に<var>H</var>,<var>W</var>,<var>L</var>が与えられる。<br/>
それぞれ、ステージの縦の長さ、横の長さ、ブロックの長さを示す。<br/>
次に<var>H</var>&times;<var>W</var>の二次元グリッドが与えられる。これはステージの情報を表している。<br/>
</p>


<h2>Constraints</h2>
<p>入力は以下の条件を満たす。</p>
<ul>

<li>1 &le; <var>H</var>,<var>W</var> &le; 25</li>
<li>1 &lt; <var>L</var> &lt; 10</li>
<li>Cell は Cell = {'A','B','C','D','E','S','G','a','b','c','d','e','^','#','.'} から成る。</li>

</ul>

<h2>Output</h2>
<p>
ステージの情報と金属体の初期位置が与えられるので、このパズルを解く最短手数を求めよ。<br/>
解が存在しない場合は-1を出力しなさい。<br/>
</p>

<h2>Sample Input 1</h2>
<pre>
5 5 2
#####
#S.G#
#...#
#...#
#####
</pre>

<h2>Sample Output 1</h2>
<pre>
4
</pre>

<h2>Sample Input 2</h2>
<pre>
3 12 2
############
#S..A..a..G#
############
</pre>

<h2>Sample Output 2</h2>
<pre>
6
</pre>

<h2>Sample Input 3</h2>
<pre>
3 12 2
############
#S...A.a..G#
############
</pre>

<h2>Sample Output 3</h2>
<pre>
-1
</pre>

<h2>Sample Input 4</h2>
<pre>
7 13 3
#############
#S....#.....#
#.....#.....#
#.....#.....#
#...........#
#..........G#
#############
</pre>

<h2>Sample Output 4</h2>
<pre>
8
</pre>


<h2>Sample Input 5</h2>
<pre>
3 12 2
############
#S^^.^^.^^G#
############
</pre>

<h2>Sample Output 5</h2>
<pre>
6
</pre>